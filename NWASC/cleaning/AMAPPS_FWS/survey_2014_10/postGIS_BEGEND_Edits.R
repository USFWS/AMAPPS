#----------#
# remove BEG/END counts that were added but are not legitimate
#----------#

#IDs to remove, invalid BEG/END added 
to.remove = c(4698.99,4704.01,
  6730.99,6736.01,
  9361.99,9368.01,
  9401.99,9406.01,9651.99,9655.01,
  30159.99,30162.01,
  30385.99,30388.01, 
  5157.99:5176.01,
  30562.99, 30563:30566, 30566.01,
  30716.99, 30717:30719.00, 30719.01,
  30997.01, 30993.99, 30994:30997, 31108.99,31109,31110,31110.01, 31104.01, 31106.99,
  31380.99, 31383.01, 31381:31383,
  33344.99, 33348.01, 33345:33348,32341.01, 32338.99, 32339:32341,
  32619.01, 32615.99, 32616:32619,
  32857.01, 32855:32857, 33064.99, 33065:33066, 33066.01,
  37314.01, 37312:37314, 37311.99,
  39037.01, 39033.99, 39034:39037,
  39252.99, 39256.01, 39253:39256, 39538.99, 39541.01, 39539:39541,
  51451.99, 51455.01, 51452:51455, 50694.99, 50698.01, 50695:50698,
  51784.99, 51788.01, 51785:51788, 51823.99, 51827.01, 51824:51827, 
  52217.99, 52221.01, 52218:52221,
  52646.99, 52650.01, 52647:52650,
  53089.99, 53093.01, 53090:53093, 53454.01, 53458.99, 53515.99, 53519.01, 53516:53519,
  53932.99, 53933:53937, 53937.01,
  56777.99, 56778:56781, 56781.01, 56922.99, 56923:56926, 56926.01,
  57156.99, 57157:57160, 57160.01,
  57464.99, 57465:57468, 57468.01,
  57794.99, 57798.01, 57795:57798,
  58111.99, 58115.01, 58112:58115,
  58725.99, 58729.01, 58726:58729,
  59286.99, 59290.01, 59287:59290,
  94012.99, 94018.01, 94013:94018,
  94240.99, 94255.01, 94241:94255, 94359.99, 94365.01, 94360:94365,
  95110.99, 95117.01, 95111:95117, 95301.99, 95307.01, 95302:95307, 95325.99, 95331.01, 95326:95331,
  97695.99, 97701.01, 97696:97701,
  97926.99, 97932.01, 97927:97932,
  100135.99, 100136:100141, 100141.01,
  100551.99, 100552:100557, 100557.01,
  100760.99, 100761:100767, 100767.01,
  102614.99, 102615:102621, 102621.01,
  102851.99, 102852:102857, 102857.01,
  109262.99, 109263:109265, 109265.01, 109353.99, 109354:109360, 109360.01,
  120380.99, 120381:120382, 120382.01,
  120982.99, 120983:120984, 120984.01,
  122226.99, 122227:122228, 122228.01,
  127812.99, 127813:127815, 127815.01, 127817.99, 127818:127821, 127821.01,
  133429.99,133430:133499,133499.01,
  6206,6207,6208,12320,12321,12322,17229,17230,17231,19992,19993,19994,23427,23428,23429,
  28212,28213,28214,62033,62034,62035,67020,67021,67022,71879,71881,71882,74671,74672,
  74673,79519,79520,79521,89433,89434,89435, 125403.99, 125404:125409, 125409.01, 125414.99, 
  125415:125420, 125420.01, 131265:131267, 139671, 139672, 139674, 125425.99, 125426:125430, 125430.01,
  125430.99, 125431:125433, 125433.01,
  134123.99, 134124:134125, 134125.01,
  145672.99, 145673:145678, 145678.01, 145683.99, 145684:145689, 145689.01, 
  145694.99, 145695:145699, 145699.01, 145699.99, 145700:145702, 145702.01, 151435:151437, 159770:159772,
  36069,36070,36071,42209,42210,42211,47127,47129,47130,49901,49902,49903,53369,53370,53371,
  58162,58163,58164,93574,93575,93576,
  154016.99, 154017:154019, 154019.01,
  154727.99, 154728:154729, 154729.01,
  3211.99, 5158:5176, 5176.01, 32854.99, 
  99025.99, 99026:99031, 99031.01, 
  106468.01, 106089.99, 106468.99, 106089.01, 104453.01
)

track.final = track.final[!track.final$ID %in% to.remove,]  

track.final$type[track.final$ID %in%  c(3212, 32858, 98658)] = "BEGSEG"
track.final$type[track.final$ID %in%  c(33020.01, 98657, 104453)] = "ENDSEG"
#----------#


#----------#
# change based on time/distance travels between points - doesn't make sense
#----------#
track.final = track.final[!track.final$ID %in% c(53520,57799),] 
track.final$type[track.final$ID %in% 53521] = "BEGSEG"
track.final$type[track.final$ID %in% 57800] = "BEGSEG"
#----------#


#----------#
# change offline
#----------#
track.final$offline[track.final$ID == 53459.00] = 0
#----------#


#----------#
#change transect
#----------#
track.final$transect[track.final$ID %in% c(104393.99, 104394:104453, 104453.99)] = 391600
track.final$transect[track.final$ID %in% c(105412.99, 105413:105549, 105549.01)] = 385601
track.final$transect[track.final$ID %in% c(105592.99, 105593:105651, 105651.01, 105690.99,105691:105741, 105741.01)] = 385100
track.final$transect[track.final$ID %in% c(106089.99, 106090:106154, 106154.01, 105950.99, 105951:106089, 106089.99)] = 384601
track.final$transect[track.final$ID %in% c(106194.99, 106195:106257, 106257.01, 106257.99, 106258:106342, 106342.01)] = 384100
track.final$transect[track.final$ID %in% c(106469.99, 106469:106526, 106526.01, 106374.99, 106375:106468, 106468.01)] = 383601
track.final$transect[track.final$ID %in% c(106564.99, 106565:106621, 106621.01, 106621.99, 106622:106707, 106707.01)] = 383100
track.final$transect[track.final$ID %in% c(106831.99, 106832:106888, 106888.01, 106739.99, 106740:106831, 106831.01)] = 382601
track.final$transect[track.final$ID %in% c(107182.99, 107183:107245, 107245.01, 107245.99, 107246:107305, 107305.01)] = 382100
track.final$transect[track.final$ID %in% c(105249.99, 105250:105412, 105412.01)] = 385602
track.final$transect[track.final$ID %in% c(105741.99, 105742:105906, 105906.01)] = 385101
#----------#


#----------#
# change BEG/ENDCNT to BEG/ENDSEG
#----------#
# CHANGE BEGSEG/ENDSEG TO BEGCNT/ENDCNT WHEN NECESSARY (AND VICE VERSA)
track.final = track.final %>% dplyr::mutate(key = paste(crew, seat, month, day, transect, sep="_")) 
track.final = track.final %>% group_by(key) %>% 
  dplyr::mutate(type = replace(type, row_number()==1 & type=="BEGCNT","BEGSEG"),
                type = replace(type, row_number()==n() & type=="ENDCNT","ENDSEG")) %>% 
  arrange(ID)
#----------#


#----------#
# check that after edits, all transect have equal BEG/END segs & cnts
#----------#
track.final %>% group_by(key) %>% filter(type %in% c("BEGCNT","ENDCNT","BEGSEG","ENDSEG")) %>% 
  summarize(ns = n()) %>% filter(ns %% 2 != 0)
#----------#


#----------#
# test points
#----------#
#t = c(433100)
#s = "rf"
#x = track.final[track.final$transect %in% t & track.final$seat == s,]
#x = select(x, sec, long, lat, transect, count, month, day, seat, type, key, ID, dataChange)
#plot(x$long,x$lat,col="grey")
#points(x$long[x$type %in% c("BEGSEG")], x$lat[x$type %in% c("BEGSEG")], col="darkgreen",pch=11)
#points(x$long[x$type %in% c("ENDSEG")], x$lat[x$type %in% c("ENDSEG")], col="darkred",pch=11)
#points(x$long[x$type %in% c("BEGCNT")], x$lat[x$type %in% c("BEGCNT")], col="green",pch=15)
#points(x$long[x$type %in% c("ENDCNT")], x$lat[x$type %in% c("ENDCNT")], col="red",pch=16)

#ind = c(30514.01)
#points(x$long[x$ID %in% ind], x$lat[x$ID %in% ind],col="purple",pch=0)
